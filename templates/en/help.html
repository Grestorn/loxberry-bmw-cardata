<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMW CarData Plugin - Help</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.5; padding: 10px; font-size: 13px; }
        h1 { color: #0066cc; font-size: 16px; margin: 0 0 10px 0; padding-bottom: 5px; border-bottom: 2px solid #0066cc; }
        h2 { color: #333; font-size: 14px; margin: 15px 0 8px 0; }
        p { margin: 8px 0; }
        ul, ol { margin: 5px 0; padding-left: 20px; }
        li { margin: 4px 0; }
        code { background: #f4f4f4; padding: 1px 4px; border-radius: 2px; font-family: monospace; font-size: 12px; }
        .info { background: #e7f3ff; border-left: 3px solid #0066cc; padding: 8px; margin: 8px 0; font-size: 12px; }
        .warning { background: #fff3cd; border-left: 3px solid #ff9800; padding: 8px; margin: 8px 0; font-size: 12px; }
        a { color: #0066cc; }
    </style>
</head>
<body>
    <h1>BMW CarData Plugin</h1>

    <div class="info">
        <strong>üìñ Full Documentation:</strong><br>
        <a href="https://github.com/Grestorn/loxberry-bmw-cardata/blob/main/README.md" target="_blank">GitHub README</a>
    </div>

    <h2>Quick Start</h2>

    <p><strong>1. Create BMW CarData Client</strong></p>
    <ul>
        <li>Open <a href="https://www.bmw.de/de-de/mybmw/vehicle-overview" target="_blank">MyBMW Vehicle Overview</a></li>
        <li>Select vehicle ‚Üí "Create CarData Client"</li>
        <li>Copy the <strong>Client ID</strong></li>
        <li>Activate: "CarData Stream" + "Request access to CarData API"</li>
    </ul>

    <div class="warning">
        ‚ö†Ô∏è Do <strong>not</strong> click "Authenticate Device"!
    </div>

    <p><strong>2. Get Stream Username</strong></p>
    <ul>
        <li>Scroll to "CarData Streaming"</li>
        <li>"Configure Data Stream" ‚Üí "Show Connection Details"</li>
        <li>Copy the <strong>username</strong></li>
    </ul>

    <p><strong>3. Select Data</strong></p>
    <ul>
        <li>"Change Data Selection"</li>
        <li>Select only required values</li>
        <li>"Submit and Start Stream"</li>
    </ul>

    <p><strong>4. Configure Plugin</strong></p>
    <ul>
        <li>Enter Client ID</li>
        <li>Stream Host: <code>customer.streaming-cardata.bmwgroup.com</code></li>
        <li>Stream Port: <code>9000</code></li>
        <li>Enter Stream Username</li>
        <li>"Save Configuration"</li>
    </ul>

    <p><strong>5. Perform Authentication</strong></p>
    <ul>
        <li>"Start Registration"</li>
        <li>"Go to BMW Login" ‚Üí Log in with BMW ID</li>
        <li>"Retrieve Tokens"</li>
    </ul>

    <h2>MQTT Topics</h2>
    <p>Format: <code>&lt;prefix&gt;/&lt;VIN&gt;/&lt;attribute&gt;</code></p>
    <p>Example:<br>
    <code>bmw/WBA1234.../data/vehicle.powertrain.electric.battery.chargeLevel.percent/value</code></p>

    <div class="warning">
        ‚ö†Ô∏è BMW only sends data when changes occur. Unlock car to test.
    </div>

    <h2>Loxone Integration</h2>
    <ul>
        <li>Open LoxBerry MQTT Gateway</li>
        <li>Add subscription: <code>bmw/#</code></li>
        <li>Guide: <a href="https://wiki.loxberry.de/konfiguration/widget_help/widget_mqtt/mqtt_gateway/mqtt_schritt_fur_schritt_mqtt_loxone" target="_blank">MQTT Step by Step</a></li>
    </ul>

    <h2>Troubleshooting</h2>

    <p><strong>Authentication fails:</strong></p>
    <ul>
        <li>Check Client ID and username</li>
        <li>Check logs on "Logs" tab</li>
    </ul>

    <p><strong>Bridge doesn't start:</strong></p>
    <ul>
        <li>Status must be "Authenticated"</li>
        <li>Click "Manually Refresh Token"</li>
    </ul>

    <p><strong>No data in Loxone:</strong></p>
    <ul>
        <li>Check bridge status</li>
        <li>Data selected in BMW portal?</li>
        <li>Check bridge logs (message count)</li>
        <li>Unlock vehicle to test</li>
    </ul>

    <h2>FAQ</h2>

    <p><strong>How long is authentication valid?</strong><br>
    Max. 2 weeks, auto-renewed every 10 min.</p>

    <p><strong>Separate config per vehicle?</strong><br>
    No! Stream automatically includes all vehicles.</p>

    <p><strong>What happens on LoxBerry reboot?</strong><br>
    Bridge starts automatically at system startup.</p>

</body>
</html>
